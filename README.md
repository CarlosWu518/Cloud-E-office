# Cloud-E-office
云E办前后端分离项目

## yeb项目后端逻辑实现

#### 登录功能

​		首先前端输入用户名密码传给后端，去判断用户名和密码是否正确，如果用户名和密码正确的话，我们就会给它生成一个jwt令牌，返回给前端，如果用户名和密码不正确，就让用户重新输入；当前端拿到jwt令牌后，就会把他放在请求头里，之后的每一次请求都会携带jwt令牌，在之后每次请求之前都会通过jwt令牌的拦截器，去判断jwt令牌是否存在以及令牌是否正确合法有效，如果不存在或者并不是合法有效，就会将其拦截，反之就可以让用户去访问其他接口

#### 登录功能整体的业务逻辑

​	**登录**	前端传用户名和密码，因为只需要用户名和密码就单独准备一个实体类RespBean.java只用来接受用户名和密码而不用Admin实体类传，后期如果有拓展的话也方便拓张（比如验证码），当前端把用户名和密码传过来之后，后端先去登录（用的是SpringSecurity自带的userDetailsService里面的loadUserByUsername(username)这个方法），登录成功之后就返回一个token，反之重新登录，返回到前端之后，前端就会把token放在请求头里，之后的每一次请求都会携带这个请求头，这个时候我们要去准备一个专门token的拦截器，去判断一下携带过来的token是否是有效的，如果是无效的，那就认为是未登录的或者是token失效了，需要其去重新登录，如果是有效的，才会允许用户访问其他的接口；

​	**退出**      直接判断一下返回给前端200的状态码，前端去判断是否收到200的状态码，收到之后在请求头里把token删除，之后用户再去访问接口时就会被拦截器拦截

​    **获取当前登录用户对象**    

主要是在controller层使用的 Principal 这个类 ，在service层中，已经在SpringSecurity里面全局更新了authenticationToken对象，所以我们才可以通过·这个对象去获取到用户名，然后根据用户名去查询用户，返回回去，如果没有更新就获取不到用户名

#### 菜单列表模块

​	简单的来说，根据用户id来查询用户菜单列表（通过 SecurityContextHolder.getContext().getAuthentication().getPrincipal()).getId()；获取id）

##### 	表设计图

​	![](E:\LearnWeb\VueProject\云E办\设计图\权限表设计.png)

##### 	如何进行角色判断

​		我们现在处于登录状态才会进行相应权限判断，第一：登录之后就有对应的用户，根据用户就可以拿到对应的多个角色，第二：我们可以根据请求的url去判断角色，就比如说我们现在要去访问一个url，我会先去根据这个url找到对应的菜单id，根据中间表去判断他需要哪些角色去拥有这些url的权限，来进行比较，就可以知道用户是否真的有访问菜单的权限

#### 